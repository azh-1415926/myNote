# **Linux 系统编程笔记**
## **Linux 基本命令与介绍**

Linux，全称 GNU/Linux，是一种免费使用和自由传播的类UNIX操作系统，其内核由林纳斯·本纳第克特·托瓦兹于1991年10月5日首次发布，它主要受到 Minix 和 Unix 思想的启发，是一个基于 POSIX 的多用户、多任务、支持多线程和多 CPU 的操作系统。它能运行主要的 Unix 工具软件、应用程序和网络协议。它支持 32 位和 64 位硬件。Linux 继承了 Unix 以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。Linux有上百种不同的发行版，如基于社区开发的 debian、archlinux，和基于商业开发的 Red Hat Enterprise Linux、SUSE、Oracle Linux等

### **一、Linux 系统目录结构**
* / 根目录
    * 一般根目录下只存放目录，有且只有一个根目录
    * 所有的东西都是从根目录开始
* /bin: /usr/bin 存放二进制可执行程序
    * 常用的unix命令(ls,echo,bash,mv,rm)
* /boot 存放系统启动时用到的一些文件
    * 如 : Linux的内核文件 /boot/vmlinuz
    * 如 : 系统引导管理器 /boot/grub
* /dev 存放设备文件、字符设备、块设备
    * 访问该目录下某个文件，相当于访问某个设备
    * 如 : 挂载光驱 mount /dev/cdrom /mnt
* /home 存放系统默认的用户家目录
    * 新增用户账号时，用户的家目录都存放在此目录下
    * ~表示当前用户的家目录，~user 表示用户 user 的家目录
* /etc 用户信息和系统配置文件
    * 例如密码文件/etc/passwd ,常用的hosts配置文件
* /lib: /usr/lib: /usr/local/lib 存放系统使用的函数库的目录
    * 程序在执行过程中，需要调用一些额外的参数时需要函数库的协助
* /root 系统管理员root的家目录
* /sbin: /usr/sbin: /usr/local/sbin 放置系统管理员使用的可执行命令
    * 如fdisk、shutdown、mount 等
    * 与 /bin 不同的是，这几个目录是给系统管理员 root使用的命令，一般用户只能”查看”而不能设置和使用
* /proc 此目录的数据都在内存中
    * 如系统核心，外部设备，网络状态，由于数据都存放于内存中，所以不占用磁盘空间
    * 比较重要的目录有 /proc/cpuinfo、/proc/interrupts、/proc/dma、/proc/ioports、/proc/net/* 等
* /usr 应用程序存放目录
    * /usr/bin 存放应用程序
    * /usr/share 存放共享数据
    * /usr/lib 存放不能直接运行的，却是许多程序运行所必需的一些函数库文件
    * /usr/local 存放软件升级包
    * /usr/share/doc 系统说明文件存放目录
    * /usr/share/man 程序说明文件存放目录
* /var：放置系统执行过程中经常变化的文件
    * /var/log 随时更改的日志文件 
    * /var/log/message 所有的登录文件存放目录 
    * /var/spool/mail 邮件存放的目录 
    * /var/run 程序或服务启动后，其PID存放在该目录下

---
### **二、Linux 目录操作命令**

Linux 命令的基本格式为 `命令名 选项 参数`，选项和参数的位置可以互换

1. #### 列出文件 `ls` 命令

ls 是 Linux 下最常用的命令之一，作用是列出目录下的文件

    ```shell
    [root@localhost ~]# ls
    test2.c  test.c
    [root@localhost ~]# ls -l
    total 0
    -rw-r--r-- 1 root root 0 Jan  3 15:39 test2.c
    -rw-r--r-- 1 root root 0 Jan  3 15:39 test.c
    [root@localhost ~]# 
    ```

* 相关命令参数
    * `ls 参数 选项` 列出指定目录下的目录项，不加选项默认显示当前目录下的目录项
    * `ls -l 选项` 显示指定目录项详细信息
    * `ls -dl 选项` 显示指定目录的详细信息
    * `ls -R 选项` 递归查看指定目录
    * `ls -Rl 选项` 递归查看指定目录下的目录项有关详细信息
    * `ls -F 选项` 根据文件、目录等信息类型，给出类型标记符号

2. #### 切换目录 `cd` 命令

* 有几个特殊的目录名可以用在 cd 命令中 `.`，`..`，`~`，`-`

  * `.` 代表当前目录

  * `..` 代表当前目录的上一级目录

  * `~` 代表家目录，后若接用户名，对应用户的家目录，如 ~root 代表 root 用户的家目录

  * `-` 用在 cd 命令中可切换到上一次的工作目录

* 使用方法

  * `cd 选项` 切换到某个目录，不带任何选项默认切换到家目录

  * `cd ~` 返回家目录，不带 ~ 也是一样的效果
  * `cd -` 返回上一个工作目录

3. #### 显示工作目录 `pwd` 命令
    * `pwd` 显示目前所在目录的命令
    * `pwd -P` 显示出确实的路径，而非使用链接 (link) 路径
4. #### 创建目录 `mkdir` 命令
    * `mkdir 选项` 创建目录
    * `mkdir -m 选项` 创建目录并配置文件的权限
    * `mkdir -p 选项` 递归创建目录
5. #### 删除空目录 `rmdir` 命令
    * `rmdir 选项` 删除空目录
    * `rmdir -p 选项` 递归删除空目录

---

### **四、Linux 文件操作命令**

1. #### 拷贝 `cp` 命令
    * 相关命令参数
        * `cp 源目录项 目标目录项` 复制源目录项到目标目录项处
        * `cp -a 源目录 目标目录` 复制源目录其下所有文件到目标目录
            * -a是完全复制，文件权限和改动时间等完全相同
        * `cp -r 源目录 目标目录` 递归复制源目录到目标目录
        * 其他参数
            * -i 若目标档(destination)已经存在时，在覆盖时会先询问动作的进行(常用)
            * -f 为强制(force)的意思，若目标文件已经存在且无法开启，则移除后再尝试一次
            * -l 进行硬式链接(hard link)的链接档创建，而非复制文件本身
            * -d 若来源档为链接档的属性(link file)，则复制链接档属性
            而非文件本身
            * -s 复制成为符号链接档 (symbolic link)

2. #### 删除 `rm` 命令
    * `rm -f 选项` 忽略不存在的文件，不会出现警告信息；
    * `rm -i 选项` 互动模式，在删除前会询问使用者是否动作
    * `rm -r 选项` 递归删除

3. #### 移动 `mv` 命令
    * `mv 参数 选项1 选项2` 可以移动文件，也可以用于给文件改名
    * `mv -f 选项 选项` 如果目标文件已经存在，不会询问而直接覆盖
    * `mv -i 选项 选项` 若目标文件 (destination) 已经存在时，就会询问是否覆盖

4. #### 链接 `ln` 命令
    链接分为软连接和硬链接，用于解决文件的共享使用
    * 硬链接是指通过索引节点来进行链接
        * 在Linux的文件系统中，保存在磁盘分区中的文件不管是什么类型都会给它分配一个编号，这个编号被称为索引节点编号，它是文件或者目录在一个文件系统中的唯一标识，文件的实际数据放置在数据区域，硬链接的作用之一是允许一个文件拥有多个有效路径名
        * 硬链接只能在同一文件系统中的文件之间进行链接，不能对目录进行创建
        * 只有当最后一个链接被删除后，此时如果有新数据要存储到磁盘上，被删除的文件的数据块及目录的链接才会被释放，空间被新数据暂用覆盖
    * 软链接也叫符号链接
        * 它类似于windows系统中的快捷方式，存放的内容是另一文件的路径名的指向，通过这个方式可以快速定位到软连接所指向的源文件实体
        * 软链接可对文件或目录创建，便于文件的管理，比如把一个复杂路径下的文件链接到一个简单路径下方便用户访问
        * 删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接就变成了死链接

    * 软硬链接的优缺点
        * 硬链接
            * 以文件副本的形式存在，但不占用实际空间
            * 不支持对目录创建硬链接
            * 只有在同一个文件系统中才能创建
            * 删除其中一个硬链接文件并不影响其他有相同 inode 号的文件
        * 软链接
            * 支持跨文件系统创建
            * 支持对目录进行链接
            * 节省空间解决空间不足问题
            * 软链接支持对一个不存在的文件名进行链接，而硬链接必须要有源文件
    * 软硬链接的创建
        * `ln 源文件名称 硬链接文件名称` 不带任何参数创建一个硬链接
        * `ln -s 源文件名称 软链接文件名称` 使用 -s 参数创建一个软链接


    ```shell
    # 创建一个软链接
    ln -s source target
    # 创建一个硬链接
    ln source target
    ```

5. #### 查看文件内容 `cat` 和 `tac` 命令

    * 常用查看命令

      * `cat 参数 选项` 查看文件内容
        * -n 参数可以显示行号
        * -A 相当于 -vET 的整合选项，可列出一些特殊字符而不是空白而已
        * -b 列出行号，仅对非空白行显示行号
        * -n 列印出行号，连同空白行也会有行号
        * -E 将结尾的断行字节 $ 显示出来
        * -T 将 [tab] 按键以 ^I 显示出来
        * -v 列出一些看不出来的特殊字符
      * `tac 选项` 从最后一行开始显示，tac 是 cat 倒着写的
* 其他查看命令
    
  * `nl` 显示的时候，顺道输出行号
      * `more` 一页一页的显示文件内容
  * `less` 与 more 类似，但是比 more 更好的是，他可以往前翻页
      * `head` 只看前面十行，-n 指定行数
  * `tail` 只看后面十行，-n 指定行数

---

### **五、Linux 文件属性与权限**

Linux 下有7或者8种文件类型，使用命令 `ll`( `ls -l` 的别名) 可以显示文件类型和有关详细信息

对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户，用户是按组分类的，一个用户属于一个或多个组，文件所有者以外的用户又可以分为文件所属组的同组用户和其他用户，对于 root 用户来说，一般情况下，文件的权限对其不起作用

```shell
[root@localhost ~]# ll
total 0
-rw-r--r-- 1 root root 0 Jan  3 15:39 test2.c
-rw-r--r-- 1 root root 0 Jan  3 15:39 test.c
[root@localhost ~]# 
```
* 使用 `ll` 命令时，显示的详细信息，以文件 test.c 为例
    * 文件类型 `-`
        * 列出的第一个属性代表了它是一个什么类型的文件，更多文件类型的标识
            * `-` 普通文件
            * `d` 目录文件
            * `c` 字符设备文件
            * `b` 块设备文件
            * `l` 软链接
            * `p` 管道文件
            * `s` 套接字
            * 未知文件

    * 文件权限 `rw-r--r--`
        * 文件权限被分为了三组，分别是文件所属用户(owner)、所属用户组(group)、其他用户(others)
        * 其中， **r** 代表可读(read)、 **w** 代表可写(write)、 **x** 代表可执行(execute)、无权限则显示 `-`

    * 硬链接计数 1
    * 所有者 root
    * 所属者 root
    * 大小 0
    * 时间 Jan  3 15:39
    * 文件名/文件夹 test.c


1. ### 修改权限 `chmod` 命令

Linux文件属性有两种设置方法，一种是数字，一种是符号

数字代表的权限可用一个八进制数来表示，以 `rwx` 为位权，`r` 权重占比4，`w` 权重占比2，`x` 权重占比1，故上诉文件权限rw-r--r-- 对应三组八进制数 110、100、100，换算成十进制数即 644，完全开放权限就是 777

* `chmod 参数 权限属性 file` 将文件的权限属性修改成指定权限属性
* 具体参数
  * -c 若该文件权限确实已经更改，才显示其更改动作
  * -f 若该文件权限无法被更改也不要显示错误讯息
  * -v  显示权限变更的详细资料
  * -R 对目前目录下的所有文件与子目录进行相同的权限变更(即以递归的方式逐个变更)


符号代表的权限比较直观，可以直接用 `rwx` 来表示

* `chmod 用户+权限 file` 指定所属用户(u)、组(g)、其他用户(o)，全部用户(a)中的一个添加权限(r、w、x)，未指定则默认对所属用户及所属用户组及其他用户进行操作
* `chmod 用户-权限,用户-权限 file` 指定所属用户...去除权限，并对其他用户、组、其他用户进行操作
* `chmod 用户=权限,用户= file` 指定所属用户...重新指定权限，赋值为空即去除对应用户...全部权限

2. ### 修改所属用户 `chown` 命令


chown 命令(change owner)用于设置文件所有者和文件关联组，Linux/Unix 是多人多工操作系统，所有的文件皆有拥有者，利用 chown 将指定文件的拥有者改为指定的用户或组，chown 需要超级用户 root 的权限才能执行此命令，只有超级用户和属于组的文件所有者才能变更文件关联组，非超级用户如需要设置关联组可能需要使用 chgrp 命令

* `chown 参数 用户 file` 将文件的所有者设为指定用户
* `chown 参数 用户:用户组 file` 将文件所有者设为指定用户，用户组设为指定用户组
* 具体参数
  * -c  显示更改的部分的信息
  * -f 忽略错误信息
  * -h 修复符号链接
  * -v 显示详细的处理信息
  * -R 递归

3. ### 修改所属用户组 `chgrp` 命令

chgrp 命令(change group)用于变更文件或目录的所属群组，与 chown 命令不同，chgrp 允许普通用户改变文件所属的组，只要该用户是该组的一员

在 UNIX 系统家族里，文件或目录权限的掌控以拥有者及所属群组来管理。您可以使用 chgrp 指令去变更文件与目录的所属群组，设置方式采用群组名称或群组识别码皆可

* `chgrp 参数 用户组 file` 将文件添加到指定用户组

* 具体参数

  * -c 或 --changes 显示更改的部分的信息

  * -f 或 --quiet 或 --silent 不显示错误信息

  * -h 或 --no-dereference 只对符号连接的文件作修改，而不改动其他任何相关文件

  * -R 或 --recursive 递归处理，将指定目录下的所有文件及子目录一并处理

  * -v 或 --verbose 显示指令执行过程